(()=>{let e={modalBlock:document.getElementById("modalBlock"),modalEditButton:document.getElementById("modalEditButton"),onShow:t=>{e.modalBlock.classList.remove("hide")},onHide:()=>{e.modalBlock.classList.add("hide")}},t={chatBlock:document.getElementById("chatBlock"),chatPublishRequestButton:document.getElementById("chatPublishRequest"),attacheInputLink:document.getElementById("attacheInputLink"),attacheInput:document.getElementById("attacheInput"),chatScreen:document.getElementById("chatScreen"),sendButton:document.getElementById("sendButton"),messageInput:document.getElementById("messageInput"),chatEmptyBlock:document.getElementById("chatEmptyBlock"),chatControls:document.getElementById("chatControls"),audioControls:document.getElementById("audioControls"),shadowBlock:document.getElementById("shadowBlock"),bottomPanel:document.getElementById("bottomPanel"),cameraButton:document.getElementById("cameraButton"),audioButton:document.getElementById("audioButton"),galleryButton:document.getElementById("galleryButton"),audioRecordInput:document.getElementById("audioRecordInput"),closeAudioButton:document.getElementById("closeAudioButton"),sendAudioButton:document.getElementById("sendAudioButton"),hideBottomPanel:()=>{t.bottomPanel.classList.add("hide"),t.shadowBlock.classList.add("hide")},showBottomPanel:()=>{t.bottomPanel.classList.remove("hide"),t.shadowBlock.classList.remove("hide")},hideAudioInput:()=>{t.audioControls.classList.add("hide"),t.chatControls.classList.remove("hide")},showAudioInput:()=>{t.chatControls.classList.add("hide"),t.audioControls.classList.remove("hide"),t.hideBottomPanel()},hideChatEmptyBlock:()=>{t.chatEmptyBlock.classList.add("hide")},showChatEmptyBlock:()=>{t.chatEmptyBlock.classList.remove("hide")},onPublishRequestClick:()=>{e.onShow()},enablePublishRequest:()=>{t.chatPublishRequestButton.classList.remove("disable")},disablePublishRequest:()=>{t.chatPublishRequestButton.classList.add("disable")},handleFiles:()=>{let e=t.attacheInput.files;if(t.hideBottomPanel(),FileReader||alert("Your browser doesn't suppport FileReader"),FileReader&&e&&e.length){let n=e[0].type.split("/")[0];t.addSource(n,e[0]),attacheInput.value=null}},videoFileHtml:(e,t)=>`\n            <div class="item" id="item-${t}">\n                <div class="close-button" id="close-${t}"><img src='./images/close.svg'/></div>\n                <div class="attache video">\n                    <video preload="metadata" id="${t}">\n                        <source src="${e}" type="video/mp4">\n                    </video>\n                    <div class="video-button-block" id="button-block-${t}">\n                        <div class="video-button" id="button-${t}">\n                            <img src="./images/play.svg" alt="">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,audioFileHtml:(e,n)=>`\n            <div class="item" id="item-${n}">\n                <div class="close-button" id="close-${n}"><img src='./images/close.svg'/></div>\n                <div class="audio">\n                    <audio controls id="${n}">\n                        <source src="${e}">\n                    </audio>\n                </div>\n                <div class="time">${t.getTime()}</div>\n            </div>\n        `,imageFileHtml:(e,t)=>`\n            <div class="item" id="item-${t}">\n                <div class="close-button" id="close-${t}"><img src='./images/close.svg'/></div>\n                <div class="image">\n                    <img id="${t}" src="${e}" alt="">\n                </div>\n            </div>\n        `,textHtml:(e,n)=>`\n            <div class="item" id="item-${n}">\n                <div class="close-button" id="close-${n}"><img src='./images/close.svg'/></div>\n                <div class="text">\n                    ${e}\n                </div>\n                <div class="time">${t.getTime()}</div>\n            </div>\n        `,addSource:(e,n)=>{switch(e){case"video":t.addVideo(n);break;case"audio":t.addAudio(n);break;case"image":t.addImage(n);break;default:alert("Please attache video, audio or image")}t.chatEmptyBlock.classList.contains("hide")||t.hideChatEmptyBlock(),t.chatPublishRequestButton.classList.contains("disable")&&t.enablePublishRequest()},getTime:()=>{let e=new Date,t=e.getHours(),n="AM",d=e.getMinutes();return t>12&&(t-=12,n="PM"),d<10&&(d="0"+d),`${t}:${d}${n}`},addImage:e=>{let n=new FileReader;n.readAsDataURL(e),n.onload=function(){let e="image-"+Math.floor(1e3*Math.random());new Promise(((d,o)=>{t.chatScreen.innerHTML+=t.imageFileHtml(n.result,e),d("ok")})).then((()=>{d()}))}},addAudio:e=>{let n=new FileReader;n.readAsDataURL(e),n.onload=function(){let e="audio-"+Math.floor(1e3*Math.random());document.getElementById("item-"+e),new Promise(((d,o)=>{t.chatScreen.innerHTML+=t.audioFileHtml(n.result,e),d("ok")})).then((()=>{document.getElementById("close-"+e),document.getElementById("item-"+e),d()}))}},addVideo:e=>{let n=new FileReader;n.readAsDataURL(e),n.onload=function(){let e="video-"+Math.floor(1e3*Math.random());new Promise(((d,o)=>{t.chatScreen.innerHTML+=t.videoFileHtml(n.result,e),d("ok")})).then((()=>{let t="button-"+e,n=document.getElementById(t),o=document.getElementById(e),a=document.getElementById("button-block-"+e);document.getElementById("item-"+e),document.getElementById("close-"+e),n.addEventListener("click",(function(){a.style.display="none",o.play(),o.setAttribute("data-state","play")})),o.addEventListener("click",(function(){switch(a.style.display="none",o.dataset.state){case"play":o.pause(),o.setAttribute("data-state","pause");break;case"pause":o.play(),o.setAttribute("data-state","play")}})),d()}))}},addText:e=>{let n="message-"+Math.floor(1e3*Math.random());new Promise(((d,o)=>{t.chatScreen.innerHTML+=t.textHtml(e,n),d("ok")})).then((()=>{d()}))}};var n;function d(){n=document.getElementsByClassName("close-button");for(let e=0;e<n.length;e++)n[e].addEventListener("click",(function(){this.parentElement.remove()}))}e.modalEditButton.addEventListener("click",e.onHide),t.chatPublishRequestButton.addEventListener("click",e.onShow),t.attacheInputLink.addEventListener("click",(function(e){e.preventDefault(),t.showBottomPanel()})),t.galleryButton.addEventListener("click",(function(e){t.attacheInput.click()})),t.attacheInput.addEventListener("change",t.handleFiles,!1),t.audioButton.addEventListener("click",(function(e){t.showAudioInput()})),t.closeAudioButton.addEventListener("click",(function(e){t.hideAudioInput()})),t.sendAudioButton.addEventListener("click",(function(e){console.log("send audio")})),t.sendButton.addEventListener("click",(function(){t.messageInput.value&&(t.hideChatEmptyBlock(),t.enablePublishRequest(),t.addText(t.messageInput.value),t.messageInput.value=null)}))})();